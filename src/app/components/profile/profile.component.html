@if(currentUser$ | async; as currentUser) {
<div class="margin-y-10">
  <div class="pad-x-10 flex flex-col">
    <div class="flex justify-between">
      <div class="flex items-center">
        <button (click)="goBack()" class="flex items-center" mat-mini-fab>
          <mat-icon class="text-white">arrow_back</mat-icon>
        </button>
        <div class="pad-x-10 flex flex-col">
          <span class="text-2xl text-white font-bold font-ui">{{
            currentUser.username
          }}</span>
          <span class="font-gray font-ui text-sm">
            {{ numMessages$ | async }} messages
          </span>
        </div>
      </div>
      <div>
        @if(isAuthProfile$ | async) {
        <button mat-button class="edit">Edit</button>
        <button mat-button class="margin-left-10 delete">Delete</button>
        }
      </div>
    </div>
  </div>
  <div class="pad-x-10 margin-left-5 margin-top-20">
    <img class="h-32 max-w-32 rounded-full" src="{{ currentUser.pic }}" />
  </div>
  <div class="pad-x-10 margin-top-5">
    <span class="text-2xl text-white font-bold font-ui">{{
      currentUser.username
    }}</span>
  </div>
  <div class="border-bottom margin-top-10 w-full h-12 flex justify-evenly">
    @for (m of modes; track m) {
    <app-option-select
      class="flex-1"
      [label]="m"
      [mode]="(mode$ | async) ?? ''"
      (labelEmitter)="changeMode($event, currentUser)"
    >
    </app-option-select>
    }
  </div>
  @for (message of filteredMessages$ | async; track message) {
  <div class="flex flex-col border-bottom cursor-pointer">
    @if(message.retwatAuthor != null) {
    <div class="flex items-center pad-top-3 pad-left-20 font-gray">
      <mat-icon class="flex items-center text-xl">recycling</mat-icon>
      <span class="margin-left-3 text-sm font-ui"
        >{{ message.retwatUsername }} Retwatted</span
      >
    </div>
    }
    <div class="flex flex-row">
      <div class="flex justify-center margin-x-6 margin-y-5">
        <img
          (click)="goToProfile(message)"
          class="h-10 max-w-10 rounded-3xl"
          src="{{ message.pic }}"
        />
      </div>
      <div
        class="flex flex-col w-full margin-top-5 pad-left-1"
        (click)="openThread(message)"
      >
        <div class="flex justify-between">
          <div class="">
            <div class="">
              <span class="font-bold text-white font-ui">{{
                message.username != null ? message.username : message.author
              }}</span>
            </div>
            <div class="margin-y-3">
              <span class="text-white font-ui">{{ message.text }}</span>
            </div>
          </div>
          <div class="flex justify-right flex-1 pad-right-5">
            @if (message.editable) {
            <button (click)="editMessage($event, message)" mat-mini-fab>
              <mat-icon class="font-gray">edit</mat-icon>
            </button>
            } @if(message.deletable) {
            <button (click)="deleteMessage($event, message)" mat-mini-fab>
              <mat-icon class="font-gray">delete</mat-icon>
            </button>
            }
          </div>
        </div>
        @if(!message.retwatAuthor) {
        <div class="pad-right-5">
          <app-action-bar
            *ngIf="currentUser$ | async as user"
            (likeEmitter)="toggleLike(user, message)"
            (retwatEmitter)="toggleRetwat(user, message)"
            (viewLikesEmitter)="viewLikes(message)"
            (viewRetwatsEmitter)="viewRetwats(message)"
            [isLikedSignal]="user.likedMessages.includes(message.uuid)"
            [isRetwattedSignal]="user.retwats.includes(message.uuid)"
            [message]="message"
          >
          </app-action-bar>
        </div>
        }
      </div>
    </div>
  </div>
  }
</div>
}
